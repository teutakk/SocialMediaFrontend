import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { dislikePost, likePost } from "../store/slices/postsSlice";
import button from "./Button.module.css";
import { selectUser } from "../store/slices/authSlice";
// import button from "./Button.module.css";

const LikeButton = ({ post }) => {
  const dispatch = useDispatch();

  const [isLiked, setIsLiked] = useState(false);
  const loggedInUser = useSelector(selectUser);

  useEffect(() => {
    const findIsLiked = post.likes?.find(
      (like) => like.userId === loggedInUser?._id
    );
    if (findIsLiked) {
      setIsLiked(true);
    } else setIsLiked(false);
  }, [post.likes]);

  const handleLikes = () => {
    if (!isLiked) {
      // if the user likes the post (Like action)
      const newLike = {
        userId: loggedInUser?._id,
        postId: post?._id,
        firstName: loggedInUser.firstName,
        lastName: loggedInUser.lastName,
      }; // This is only for example -- update when backend ready!!!
      dispatch(likePost(newLike));
      // dispatch(addLikes({ postId: post?._id, likes: newLike }));
    } else {
      // console

      const likeIndex = post.likes.findIndex(
        (likes) => likes.userId === loggedInUser?._id
      );
      const unLike = {
        userId: loggedInUser?._id,
        postId: post?._id,
      };
      // if the user has already liked the post (Dislike action)
      dispatch(dislikePost(unLike)); // Assuming post.id is used to identify the post
    }
  };

  return (
    <button
      onClick={handleLikes} // waiting for backend to catch up
      className={`${isLiked ? button.dislike : button.like} ${
        button.postPosition
      }`}
    >
      {isLiked ? (
        <div className={button.innerContent}>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="18"
            viewBox="0 0 16 18"
            fill="none"
          >
            <path
              d="M15.0167 12.2361L15.6042 8.83608C15.6387 8.6368 15.6292 8.4324 15.5764 8.23717C15.5237 8.04193 15.4289 7.86059 15.2987 7.70581C15.1685 7.55103 15.0061 7.42656 14.8228 7.34111C14.6395 7.25565 14.4398 7.21128 14.2375 7.21108H9.92005C9.81929 7.2111 9.71973 7.18919 9.62829 7.14686C9.53685 7.10453 9.45572 7.0428 9.39054 6.96597C9.32536 6.88913 9.27769 6.79902 9.25083 6.70191C9.22398 6.60479 9.2186 6.50299 9.23505 6.40358L9.78755 3.03275C9.87721 2.48544 9.85166 1.92545 9.71255 1.38858C9.65302 1.16675 9.53838 0.963565 9.37928 0.797912C9.22019 0.632258 9.02179 0.509512 8.80255 0.441081L8.68171 0.401914C8.40852 0.314156 8.11208 0.334436 7.85338 0.458581C7.57005 0.595248 7.36338 0.844415 7.28671 1.14025L6.89005 2.66858C6.76377 3.15494 6.58026 3.6246 6.34338 4.06775C5.99755 4.71525 5.46255 5.23441 4.90588 5.71358L3.70671 6.74691C3.54035 6.89067 3.41042 7.0718 3.32757 7.27546C3.24472 7.47912 3.21129 7.69951 3.23005 7.91858L3.90671 15.7461C3.93654 16.0923 4.09508 16.4147 4.35104 16.6496C4.60699 16.8846 4.94176 17.0151 5.28921 17.0152H9.16255C12.0642 17.0152 14.54 14.9936 15.0167 12.2361Z"
              fill="black"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M0.598398 6.58608C0.759448 6.57904 0.91699 6.6345 1.03812 6.74087C1.15924 6.84725 1.23458 6.99631 1.2484 7.15692L2.05673 16.5203C2.07042 16.6597 2.05555 16.8004 2.01302 16.9339C1.97048 17.0674 1.90118 17.1909 1.80935 17.2967C1.71752 17.4025 1.60508 17.4885 1.4789 17.5494C1.35272 17.6103 1.21546 17.6448 1.07548 17.6509C0.93551 17.6569 0.795768 17.6344 0.664794 17.5847C0.533819 17.5349 0.41436 17.459 0.313714 17.3615C0.213068 17.264 0.133347 17.1471 0.0794197 17.0178C0.0254925 16.8885 -0.00150883 16.7495 6.50499e-05 16.6094V7.21025C0.000133146 7.04915 0.0624038 6.8943 0.173885 6.77801C0.285366 6.66171 0.437447 6.59296 0.598398 6.58608Z"
              fill="black"
            />
          </svg>
          <p>Liked</p>
        </div>
      ) : (
        <div className={button.innerContent}>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="21"
            height="20"
            viewBox="0 0 21 20"
            fill="none"
          >
            <path
              d="M10.3537 1.77667L10.0821 1.21417L10.3529 1.77667H10.3537ZM3.12457 8.52834L3.74707 8.475C3.73273 8.31493 3.65727 8.16654 3.53637 8.06065C3.41548 7.95475 3.25844 7.8995 3.09787 7.90637C2.93731 7.91323 2.78555 7.98168 2.67414 8.09751C2.56272 8.21333 2.5002 8.36762 2.49957 8.52834H3.12457ZM17.4879 10.0475L16.8996 13.4475L18.1321 13.6608L18.7196 10.2608L17.4879 10.0475ZM11.6621 17.7083H7.78791V18.9583H11.6621V17.7083ZM7.02874 17.0108L6.35207 9.18334L5.10624 9.29084L5.78374 17.1183L7.02874 17.0108ZM16.8996 13.4475C16.4771 15.8892 14.2754 17.7083 11.6621 17.7083V18.9583C14.8504 18.9583 17.6004 16.7342 18.1321 13.6608L16.8996 13.4475ZM11.6704 4.25L11.1179 7.62084L12.3512 7.8225L12.9037 4.4525L11.6704 4.25ZM6.61457 8.53834L7.81374 7.505L6.99707 6.55834L5.79957 7.59167L6.61457 8.53834ZM9.99457 4.14334L10.3912 2.615L9.18124 2.30167L8.78457 3.82917L9.99457 4.14334ZM10.9896 2.315L11.1104 2.35417L11.4929 1.16417L11.3721 1.125L10.9896 2.315ZM9.39374 5.68C9.65405 5.19333 9.85574 4.67751 9.99457 4.14334L8.78457 3.82917C8.67064 4.26803 8.50504 4.69183 8.29124 5.09167L9.39457 5.68H9.39374ZM11.1104 2.35417C11.2293 2.39021 11.3372 2.4557 11.424 2.54456C11.5108 2.63343 11.5738 2.7428 11.6071 2.8625L12.8171 2.54917C12.731 2.22542 12.5644 1.9287 12.3329 1.68656C12.1014 1.44442 11.8125 1.26472 11.4929 1.16417L11.1104 2.35417ZM10.3912 2.615C10.4078 2.55498 10.4373 2.49929 10.4776 2.4518C10.5179 2.40432 10.5681 2.36617 10.6246 2.34L10.0821 1.21417C9.63874 1.4275 9.30541 1.8225 9.18124 2.30167L10.3912 2.615ZM10.6246 2.34C10.7386 2.28553 10.8692 2.27659 10.9896 2.315L11.3721 1.125C10.9465 0.988603 10.4848 1.02051 10.0821 1.21417L10.6237 2.34H10.6246ZM12.4196 9.15334H16.7362V7.90334H12.4196V9.15334ZM4.55707 17.8383L3.74707 8.475L2.50207 8.5825L3.31041 17.9458L4.55707 17.8383ZM3.74957 17.9275V8.52834H2.49957V17.9275H3.74957ZM3.31041 17.9458C3.30786 17.9156 3.31248 17.8851 3.32235 17.8563C3.33222 17.8276 3.34796 17.8012 3.36857 17.7789C3.38918 17.7565 3.41421 17.7387 3.44207 17.7266C3.46993 17.7144 3.50001 17.7082 3.53041 17.7083V18.9583C4.13541 18.9583 4.60874 18.44 4.55707 17.8383L3.31124 17.9467L3.31041 17.9458ZM12.9037 4.4525C13.0077 3.81894 12.9782 3.17066 12.8171 2.54917L11.6071 2.86334C11.7245 3.3161 11.7461 3.78841 11.6704 4.25L12.9037 4.4525ZM7.78791 17.7083C7.59708 17.708 7.4133 17.6362 7.27278 17.5071C7.13226 17.378 7.0452 17.2009 7.02874 17.0108L5.78374 17.1183C5.8271 17.6201 6.05697 18.0875 6.42799 18.4281C6.79902 18.7687 7.28423 18.9579 7.78791 18.9583V17.7083ZM7.81374 7.505C8.38041 7.01667 8.99041 6.43584 9.39457 5.68L8.29124 5.09167C8.00291 5.6325 7.54374 6.08834 6.99707 6.55834L7.81374 7.505ZM18.7196 10.2608C18.7697 9.97166 18.7561 9.67501 18.6796 9.39167C18.603 9.10832 18.4655 8.84514 18.2765 8.62055C18.0876 8.39596 17.8518 8.21539 17.5857 8.0915C17.3197 7.96761 17.0297 7.90339 16.7362 7.90334V9.15334C17.2087 9.15334 17.5696 9.58 17.4879 10.0475L18.7196 10.2608ZM3.53041 17.7083C3.65207 17.7083 3.74957 17.8067 3.74957 17.9275H2.49957C2.49957 18.4958 2.96041 18.9583 3.53041 18.9583V17.7083ZM11.1179 7.62084C11.0868 7.80965 11.0972 8.00297 11.1483 8.18737C11.1994 8.37177 11.2901 8.54285 11.4139 8.68872C11.5377 8.8346 11.6918 8.95179 11.8655 9.03217C12.0392 9.11254 12.2282 9.15334 12.4196 9.15334V7.90334C12.4094 7.90338 12.3994 7.90202 12.3901 7.89773C12.3809 7.89345 12.3727 7.88719 12.3662 7.87939C12.3597 7.87159 12.355 7.86245 12.3524 7.85262C12.3498 7.84279 12.3494 7.8325 12.3512 7.8225L11.1179 7.62084ZM6.35207 9.18334C6.34177 9.06266 6.35944 8.94125 6.40522 8.82912C6.451 8.71699 6.52275 8.61732 6.61457 8.53834L5.79791 7.59084C5.55625 7.7992 5.36754 8.06197 5.24729 8.35752C5.12704 8.65307 5.0787 8.97295 5.10624 9.29084L6.35207 9.1825V9.18334Z"
              fill="black"
            />
          </svg>
          <p>Like</p>
        </div>
      )}
    </button>
  );
};

export default LikeButton;
